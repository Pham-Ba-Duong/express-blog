<!DOCTYPE html>
<html lang="en">
       <meta charset="utf-8">
       <meta http-equiv="X-UA-Compatible" content="IE=edge">
       <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
       <title>Blog Home</title>
       <meta name="keywords" content="">
       <meta name="description" content="">
       <meta name="author" content="">
       <link rel="shortcut icon" href="/asset-blog/images/favicon.ico" type="image/x-icon" />
       <link rel="apple-touch-icon" href="/asset-blog/images/apple-touch-icon.png">
       <link href="https://fonts.googleapis.com/css?family=Droid+Sans:400,700" rel="stylesheet"> 
       <link href="/asset-blog/css/bootstrap.css" rel="stylesheet">
       <link href="/asset-blog/css/font-awesome.min.css" rel="stylesheet">
       <link href="/asset-blog/style.css" rel="stylesheet">
       <link href="/asset-blog/css/responsive.css" rel="stylesheet">
       <link href="/asset-blog/css/colors.css" rel="stylesheet">
       <link href="/asset-blog/css/version/garden.css" rel="stylesheet">
</head>
<header>
    <%- include('./partials/header'); %>
</header>

<body>
    <div id="wrapper">
        <div class="page-title wb">
            <div class="container">
                <div class="row">
                    <div class="col-lg-8 col-md-8 col-sm-12 col-xs-12">
                        <h2><i class="fa fa-leaf bg-green"></i> Blog</h2>
                    </div><!-- end col -->
                    <div class="col-lg-4 col-md-4 col-sm-12 hidden-xs-down hidden-sm-down">
                        <ol class="breadcrumb">
                            <li class="breadcrumb-item"><a href="#">Home</a></li>
                            <li class="breadcrumb-item active">Blog</li>
                        </ol>
                    </div><!-- end col -->                    
                </div><!-- end row -->
            </div><!-- end container -->
        </div><!-- end page-title -->
      
        
        <section class="section wb">
            <div class="container">
                <div class="row">
                    <div class="col-lg-9 col-md-12 col-sm-12 col-xs-12">
                        <div class="page-wrapper" id="<%=post._id %>" data-id="<%=post._id %>">
                            <div class="blog-title-area" id="<%=post._id %>" data-id="<%=post._id %>">
                                <span class="color-green"><a href="#" title=""><%=post.title %></a></span>
                                <h3><%=post.title %></h3>

                                <div class="blog-meta big-meta">
                                    <small><a href="" title=""><%=post.createdAt %></a></small>
                                </div><!-- end meta -->

                                <div class="post-sharing">
                                    <ul class="list-inline">
                                        <li><a href="#" class="fb-button btn btn-primary"><i class="fa fa-facebook"></i> <span class="down-mobile">Share on Facebook</span></a></li>
                                        <li><a href="#" class="tw-button btn btn-primary"><i class="fa fa-twitter"></i> <span class="down-mobile">Tweet on Twitter</span></a></li>
                                    </ul>
                                </div><!-- end post-sharing -->
                            </div><!-- end title -->

                            <div class="single-post-media">
                                <img src="<%=image%>" alt="" class="img-fluid">
                            </div><!-- end media -->

                            <div class="blog-content">  
                                <%- post.content %>
                            </div><!-- end content -->

                            <hr class="invis1">

                            <div class="custombox clearfix">
                                <h4 class="small-title">Comments</h4>
                                <div class="row">
                                    <div class="col-lg-12">
                                        <!-- <div class="comments-list">
                                            <div class="media">
                                                <div class="media-body">
                                                    <h4 class="media-heading user_name">Amanda Martines <small>5 days ago</small></h4>
                                                    <p>Exercitation photo booth stumptown tote bag Banksy, elit small batch freegan sed. Craft beer elit seitan exercitation, photo booth et 8-bit kale chips proident chillwave deep v laborum. Aliquip veniam delectus, Marfa eiusmod Pinterest in do umami readymade swag. Selfies iPhone Kickstarter, drinking vinegar jean.</p>
                                                    <a href="#" class="btn btn-primary btn-sm">Reply</a>
                                                </div>
                                            </div>                                                                        
                                        </div> -->
                                        
                                    </div><!-- end col -->
                                </div><!-- end row -->
                            </div><!-- end custom-box -->

                            <hr class="invis1">

                            <div class="custombox clearfix">
                                <h4 class="small-title">Leave a Reply</h4>
                                <div class="row">
                                    <div class="col-lg-12">
                                        <div class="form-wrapper">
                                            <input id="userCommentName" name="userCommentName" type="text" class="form-control" placeholder="Your name">
                                            <input id="userCommentEmail" name="userCommentEmail" type="text" class="form-control" placeholder="Email address">
                                            <textarea id="userComment" name="userComment" class="form-control" placeholder="Your comment"></textarea>
                                            <button type="button" id="submit" class="btn btn-primary">Submit Comment</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div><!-- end page-wrapper -->
                    </div><!-- end col -->
                    <%- include('./partials/sidebar-blog') %>

                </div><!-- end row -->
            <!-- end container -->
        </section>
       
        <div class="dmtop">Scroll to Top</div>
    </div><!-- end wrapper -->
</body>
<footer>
    <%- include('./partials/footer'); %>
</footer>

<script>
    const submitComment = async () => {
      const name = document.getElementById('userCommentName').value;
      const email = document.getElementById('userCommentEmail').value;
      const content = document.getElementById('userComment').value;
      const postId = "<%= post._id %>"; // Đảm bảo lấy ID đúng từ server
    
      // Kiểm tra dữ liệu đầu vào
      if (!postId || !name || !email || !content) {
        alert('Please fill in all fields!');
        return;
      }
    
      const commentData = { postId, content, name, email };
      console.log("commentData", commentData);
      
    
      try {
        const response = await fetch('http://localhost:8000/api/v1/comment', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(commentData),
        });
    
        const result = await response.json();
        // console.log("result:"+result); 
        
        if (response.ok) {
          // Sau khi gửi comment thành công, hiển thị comment mới mà không cần reload
          const newComment = result;
    
          // Tạo HTML cho comment mới
          const commentHTML = `
            <div class="media">
              <div class="media-body">
                <h4 class="media-heading user_name">${newComment.name} <small>${new Date(newComment.createdAt).toLocaleString()}</small></h4>
                <p>${newComment.content}</p>
              </div>
            </div>
          `;
    
          // Thêm comment mới vào danh sách comments hiện tại
          document.querySelector('.comments-list').insertAdjacentHTML('beforeend', commentHTML);
    
          // Clear form fields
          document.getElementById('userCommentName').value = '';
          document.getElementById('userCommentEmail').value = '';
          document.getElementById('userComment').value = '';
    
          alert('Comment submitted successfully!');
        } else {
          alert(result.message || 'Failed to submit comment.');
        }
      } catch (error) {
        console.error('Error submitting comment:', error);
      }
    };
    
    // Gắn sự kiện khi người dùng nhấn nút "Submit Comment"
    document.querySelector('#submit').addEventListener('click', submitComment);
</script>
    
</html>